From beb4e7232a4e0302ab8c852d57c582350589512d Mon Sep 17 00:00:00 2001
From: Mikhail Tsukerman <mikhail.tsukerman@advantech.de>
Date: Thu, 30 Oct 2025 22:23:29 +0100
Subject: [PATCH] Add build fix for mpv package

---
 .../files/0001-Fix-yocto-build-issue.patch    | 34 +++++++++++++++++++
 .../recipes-multimedia/mplayer/mpv_0.40.0.bb  |  5 ++-
 2 files changed, 38 insertions(+), 1 deletion(-)
 create mode 100644 meta-oe/recipes-multimedia/mplayer/files/0001-Fix-yocto-build-issue.patch

diff --git a/meta-oe/recipes-multimedia/mplayer/files/0001-Fix-yocto-build-issue.patch b/meta-oe/recipes-multimedia/mplayer/files/0001-Fix-yocto-build-issue.patch
new file mode 100644
index 0000000000..a4be75304a
--- /dev/null
+++ b/meta-oe/recipes-multimedia/mplayer/files/0001-Fix-yocto-build-issue.patch
@@ -0,0 +1,34 @@
+From 51ed168085a9d7073ef8c40f87bbf2c989e9d253 Mon Sep 17 00:00:00 2001
+From: Mikhail Tsukerman <mikhail.tsukerman@advantech.de>
+Date: Thu, 30 Oct 2025 14:55:27 +0100
+Subject: [PATCH] Fix yocto build issue
+Upstream-Status: Pending
+---
+ video/out/opengl/context_drm_egl.c | 4 ++--
+ 1 file changed, 2 insertions(+), 2 deletions(-)
+
+diff --git a/video/out/opengl/context_drm_egl.c b/video/out/opengl/context_drm_egl.c
+index fc78f13f0e..4a7712175f 100644
+--- a/video/out/opengl/context_drm_egl.c
++++ b/video/out/opengl/context_drm_egl.c
+@@ -176,7 +176,7 @@ static EGLDisplay egl_get_display(struct gbm_device *gbm_device)
+     if (ret != EGL_NO_DISPLAY)
+         return ret;
+ 
+-    return eglGetDisplay(gbm_device);
++    return eglGetDisplay((EGLNativeDisplayType)gbm_device);
+ }
+ 
+ static bool init_egl(struct ra_ctx *ctx)
+@@ -206,7 +206,7 @@ static bool init_egl(struct ra_ctx *ctx)
+         p->egl.display, config, p->gbm.surface);
+     if (p->egl.surface == EGL_NO_SURFACE) {
+         p->egl.surface = eglCreateWindowSurface(
+-            p->egl.display, config, p->gbm.surface, NULL);
++            p->egl.display, config, (EGLNativeWindowType) p->gbm.surface, NULL);
+     }
+     if (p->egl.surface == EGL_NO_SURFACE) {
+         MP_ERR(ctx, "Failed to create EGL surface.\n");
+-- 
+2.43.0
+
diff --git a/meta-oe/recipes-multimedia/mplayer/mpv_0.40.0.bb b/meta-oe/recipes-multimedia/mplayer/mpv_0.40.0.bb
index 3d54bbb341..90c083d554 100644
--- a/meta-oe/recipes-multimedia/mplayer/mpv_0.40.0.bb
+++ b/meta-oe/recipes-multimedia/mplayer/mpv_0.40.0.bb
@@ -17,7 +17,10 @@ LICENSE = "GPL-2.0-or-later"
 LIC_FILES_CHKSUM = "file://LICENSE.GPL;md5=570a9b3749dd0463a1778803b12a6dce"
 
 SRCREV = "e48ac7ce08462f5e33af6ef9deeac6fa87eef01e"
-SRC_URI = "git://github.com/mpv-player/mpv;name=mpv;branch=release/${@oe.utils.trim_version('${PV}', 2)};protocol=https"
+SRC_URI = " \
+    git://github.com/mpv-player/mpv;name=mpv;branch=release/${@oe.utils.trim_version('${PV}', 2)};protocol=https \
+    file://0001-Fix-yocto-build-issue.patch \
+"
 S = "${WORKDIR}/git"
 
 inherit meson pkgconfig mime-xdg
-- 
2.43.0

